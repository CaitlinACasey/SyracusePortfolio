---
title: "CDCsCHSIAnalysis"
author: "Caitlin Casey"
date: "December 17, 2019"
output:
  word_document: default
  html_document: default
---

```{r setup}
knitr::opts_chunk$set(echo = TRUE)
library(cowplot)
library(png)
library(googleway)
library(ggplot2)
library(ggrepel)
library(ggspatial)
library(lwgeom)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(maps)
library(dplyr)
library(sqldf)
library(readr)
library(reshape)
library(neuralnet)
library(e1071)
library(kernlab)
library(rgeos)
library(rgdal)
library(maptools)
library(rsample)
library(scales)
library(shiny)
library(Rcmdr)
library(tidyverse)
library(RcmdrMisc)
library(readr)
```


#Column Key
```{r pressure, echo=FALSE}
key = read.csv("C:/Users/Caitlin Casey/Desktop/SYRACUSE/USA_CHSI_DATASET/DATAELEMENTDESCRIPTION.csv")
```

#Healthypeople is a reference sheet so we won't join it. Instead, we'll use it later for comparisons
```{r}
healthypeople = read.csv("C:/Users/Caitlin Casey/Desktop/SYRACUSE/USA_CHSI_DATASET/HEALTHYPEOPLE2010.csv")
```


#Now we will combine the 5 datasets
```{r}
demographics = read.csv("C:/Users/Caitlin Casey/Desktop/SYRACUSE/USA_CHSI_DATASET/DEMOGRAPHICS.csv")
vulnpopsandenvhealth = read_csv("C:/Users/Caitlin Casey/Desktop/SYRACUSE/USA_CHSI_DATASET/VUNERABLEPOPSANDENVHEALTH.csv")
riskfactors = read.csv("C:/Users/Caitlin Casey/Desktop/SYRACUSE/USA_CHSI_DATASET/RISKFACTORSANDACCESSTOCARE.csv")
leadingcausesofdeath = read.csv("C:/Users/Caitlin Casey/Desktop/SYRACUSE/USA_CHSI_DATASET/LEADINGCAUSESOFDEATH.csv")
summarymeasures = read.csv("C:/Users/Caitlin Casey/Desktop/SYRACUSE/USA_CHSI_DATASET/SUMMARYMEASURESOFHEALTH.csv")
  
combined <- sqldf('
select 
  d.county_fips_code  ,d.state_fips_code  ,d.chsi_county_name  ,d.chsi_state_name  ,d.chsi_state_abbr  ,d.strata_id_number  ,d.strata_determining_factors  ,d.number_counties  ,d.population_size  ,d.population_density  ,d.poverty  ,d.Age_19_Under  ,d.Age_19_64 ,d.Age_65_84, d.Age_85_and_Over, d.White, d.Black, d.Native_American, d.Asian, d.Hispanic, v.No_HS_Diploma, v.Unemployed, v.Sev_Work_Disabled, v.Major_Depression, v.Recent_Drug_Use, v.Ecol_Rpt, v.Ecol_Rpt_Ind, v.Ecol_Exp, v.Salm_Rpt, v.Salm_Rpt_Ind , v.Salm_Exp, v.Shig_Rpt, v.Shig_Rpt_Ind, v.Shig_Exp, v.Toxic_Chem, v.Carbon_Monoxide_Ind, v.Nitrogen_Dioxide_Ind, v.Sulfur_Dioxide_Ind, v.Ozone_Ind, v.Particulate_Matter_Ind,  v.Lead_Ind, v.EH_Time_Span, r.No_Exercise, r.Few_Fruit_Veg, r.Obesity, r.High_Blood_Pres, r.Smoker, r.Diabetes, r.Uninsured, r.Elderly_Medicare, r.Disabled_Medicare, r.Prim_Care_Phys_Rate, r.Dentist_Rate, r.Community_Health_Center_Ind, r.HPSA_Ind, l.A_Wh_Comp, l.A_Bl_Comp, l.A_Ot_Comp, l.A_Hi_Comp, l.A_Wh_BirthDef, l.A_Bl_BirthDef, l.A_Ot_BirthDef, l.A_Hi_BirthDef, l.B_Wh_Injury, l.B_Bl_Injury, l.B_Ot_Injury, l.B_Hi_Injury, l.B_Wh_Cancer, l.B_Bl_Cancer, l.B_Ot_Cancer, l.B_Hi_Cancer, l.B_Wh_Homicide, l.B_Bl_Homicide, l.B_Ot_Homicide, l.B_Hi_Homicide, l.C_Wh_Injury, l.C_Bl_Injury, l.C_Ot_Injury, l.C_Hi_Injury, l.C_Wh_Homicide, l.C_Bl_Homicide, l.C_Ot_homicide, l.C_Hi_Homicide, l.C_Wh_Suicide, l.C_Bl_Suicide, l.C_Ot_Suicide, l.C_Hi_Suicide, l.C_Wh_Cancer, l.C_Bl_Cancer, l.C_Ot_Cancer, l.C_Hi_Cancer, l.D_Wh_Injury, l.D_Bl_Injury, l.D_Ot_Injury, l.D_Hi_Injury, l.D_Wh_Cancer, l.D_Bl_Cancer, l.D_Ot_Cancer, l.D_Hi_Cancer, l.D_Wh_HeartDis, l.D_Bl_HeartDis, l.D_Ot_HeartDis, l.D_Hi_HeartDis, l.D_Wh_Suicide, l.D_Bl_Suicide, l.D_Ot_Suicide, l.D_Hi_Suicide, l.D_Wh_HIV, l.D_Bl_HIV, l.D_Ot_HIV, l.D_Hi_HIV, l.D_Wh_Homicide, l.D_Bl_Homicide, l.D_Ot_Homicide, l.D_Hi_Homicide, l.E_Wh_Cancer, l.E_Bl_Cancer, l.E_Ot_Cancer, l.E_Hi_Cancer, l.E_Wh_HeartDis, l.E_Bl_HeartDis, l.E_Ot_HeartDis, l.E_Hi_HeartDis, l.F_Wh_HeartDis, l.F_Bl_HeartDis, l.F_Ot_HeartDis, l.F_Hi_HeartDis, l.F_Wh_Cancer, l.F_Bl_Cancer, l.F_Ot_Cancer, l.F_Hi_Cancer, l.LCD_Time_Span, s.ALE, s.US_ALE, s.All_Death  ,s.US_All_Death, s.Health_Status, s.US_Health_Status, s.Unhealthy_Days
,s.US_Unhealthy_Days 
from demographics d 
left join vulnpopsandenvhealth v on v.county_fips_code=d.county_fips_code and v.state_fips_code=d.state_fips_code
left join riskfactors r on r.county_fips_code=d.county_fips_code and r.state_fips_code=d.state_fips_code
left join leadingcausesofdeath l on l.county_fips_code=d.county_fips_code and l.state_fips_code=d.state_fips_code
left join summarymeasures s on s.county_fips_code=d.county_fips_code and s.state_fips_code=d.state_fips_code
' )
```
#We know that negative numbers are really NAs; let's replace them
```{r}
combined[,-1:-7] <-  data.frame(lapply(combined[,-1:-7], function(x){
    as.numeric(gsub("-1*|-2*|-9*",NA,x))
}))

str(combined)
write_csv(combined,'combined.csv')
```

#Replace NAs with mean of column auto
```{r}
na_mean_swap <- function(x) {
  replace(x, is.na(x),mean(as.numeric(x),na.rm=TRUE))
}
mean_clean <- cbind(combined[,1:7],replace(combined[,-1:-7],TRUE, lapply(combined[,-1:-7], na_mean_swap)))
str(mean_clean)
```

#####Bar Graphs for Demographics######
#Transform demographics for valid columns
# subset data to only include some columns
```{r demographs, include=FALSE}
demographics <- subset(combined, select = 
                               c(CHSI_County_Name:CHSI_State_Abbr, Population_Size, 
                                 Population_Density, Poverty, Age_19_Under, Age_19_64, 
                                 Age_65_84, Age_85_and_Over, White, Black, Native_American, Asian, Hispanic))
```
# clean names of the subset
```{r}
nms_demo_dat <- c("county.name","state.name","state.abbr","pop.size","pop.density",
                  "poverty","age.19_under","age.19_64","age.65_84","age.85_over",
                  "white","black","nat.amer","asian","hispanic")
```

# change col names
```{r}
names(demographics)<-nms_demo_dat
```

#This data is a representation at the county level- #we have to do some work to find it at state level
```{r}
mean(demographics$pop.size)
max(demographics$pop.size)
min(demographics$pop.size)
sd(demographics$pop.size)
```

#Build vectors  
```{r}
county <- c(demographics$county.name)
state <- c(demographics$state.name)
pop <- c(demographics$pop.size)
```

# now we assemble into data frame from vectors
```{r}
df <- data.frame(county, state, pop)
```

# assembled pipe 
```{r}
stateandmeanpop <- df %>% group_by(state) %>% summarize(mean_pop = mean(pop))
stateandsumpop <- df %>% group_by(state) %>% summarize(mean_pop = sum(pop))
```


#Now we have a dataframe we can make different charts from #with each states mean population
#This is the true mean of the population in our dataset  
```{r}
mean(stateandmeanpop$mean_pop)
```

#This is the range of the population in our dataset

```{r}
max(stateandmeanpop$mean_pop)
min(stateandmeanpop$mean_pop)
sd(stateandmeanpop$mean_pop)
```


#Show mean age, and ranges
```{r}
demographics$age.19_underraw = (demographics$pop.size*demographics$age.19_under/100)
demographics$age.19_64raw = (demographics$pop.size*demographics$age.19_64/100)
demographics$age.65_84raw = (demographics$pop.size*demographics$age.65_84/100)
demographics$age.85_overraw = (demographics$pop.size*demographics$age.85_over/100)
xviiii_U <- mean(demographics$age.19_under)
max(demographics$age.19_under)
min(demographics$age.19_under)


xvii_lxiv <- mean(demographics$age.19_64)
max(demographics$age.19_64)
min(demographics$age.19_64)

lxv_lxxxiv <- mean(demographics$age.65_84)
max(demographics$age.65_84)
min(demographics$age.65_84)

lxxxv_O <- mean(demographics$age.85_over)
max(demographics$age.85_over)
min(demographics$age.85_over)
meanofage <- c(xviiii_U, xvii_lxiv, lxv_lxxxiv, lxxxv_O)
barplot (meanofage,
         main = "Figure 1 - National Age %",
         xlab = "Mean % Age",
         ylab = "Population %",
         names.arg = c("Under19", "19-64", "65-84", "Over85"),
         col = "blue",
         horiz = FALSE)
```
#Show ethnicity nationally
#But how do we create raw population numbers for age and ethnicity?
#First we have to add new columns in the data.frame with the raw data
```{r}
demographics$whiteraw = (demographics$pop.size*demographics$white/100)
demographics$blackraw = (demographics$pop.size*demographics$black/100)
demographics$hispanicraw = (demographics$pop.size*demographics$hispanic/100)
demographics$asianraw = (demographics$pop.size*demographics$asian/100)
demographics$nat.amerraw = (demographics$pop.size*demographics$nat.amer/100)
total_population <- sum(demographics$whiteraw) + sum(demographics$blackraw) + sum(demographics$hispanicraw) + sum(demographics$asianraw) + sum(demographics$nat.amerraw)
```
#Create mean vectors for each ethnicity

```{r}
w <- mean(demographics$whiteraw)
b <- mean(demographics$blackraw)
h <- mean(demographics$hispanicraw)
a <- mean(demographics$asianraw)
n.a <- mean(demographics$nat.amerraw)
```

#Create dataframe

```{r}
meanofrace <- c(w,b,h,a,n.a)
```

#converting into percentages

```{r}
w_percent <- (sum(demographics$whiteraw)/total_population)*100
b_percent <- (sum(demographics$blackraw)/total_population)*100
h_percent <- (sum(demographics$hispanicraw)/total_population)*100
a_percent <- (sum(demographics$asianraw)/total_population)*100
nat_percent <- (sum(demographics$nat.amerraw)/total_population)*100
percentofrace <- c(w_percent,b_percent,h_percent,a_percent,nat_percent)
```


#Create bar chart 
```{r}
barplot (percentofrace,
        main = "Figure 2 - National Mean Ethnicity",
        xlab = "Ethnicity",
        ylab = "Population(%)",
        names.arg = c("White", "Black", "Hispanic", "Asian", "NativeAmerican"),
        col = "darkred",
        horiz = FALSE)
```
############# Barchart Summary of Variables Most Affecting Death #############
#####################################################################
#this is from the section which takes population and percent of population into #consideration. It's a true average of the population as values are originally presented #as percentage of county.
#This calculates the count then takes percent of the US

```{r dataexploration, include=FALSE}
vuln <- sqldf('
          	select
            	county_fips_code
            	,state_fips_code
            	,chsi_county_name
            	,chsi_state_name
            	,population_size
            	,poverty
            	,No_HS_Diploma
            	,Unemployed
            	,Sev_Work_Disabled
            	,Major_Depression
            	,Recent_Drug_Use
            	,No_Exercise
            	,Few_Fruit_Veg
            	,Obesity
            	,High_Blood_Pres
            	,Smoker
            	,Diabetes
            	,Uninsured
            	,Elderly_Medicare
            	,Disabled_Medicare
            	,Prim_Care_Phys_Rate
            	,Dentist_Rate
            	,ALE
            	,All_Death
            	,US_All_Death
          	from combined')

str(vuln)
```

#Convert raw count data into percentages so we can compare it across counties with different populations

```{r}
vuln$No_HS_Diploma <- vuln$No_HS_Diploma/vuln$Population_Size*100
vuln$Unemployed <- vuln$Unemployed/vuln$Population_Size*100
vuln$Sev_Work_Disabled <-vuln$Sev_Work_Disabled/vuln$Population_Size*100
vuln$Major_Depression <- vuln$Major_Depression/vuln$Population_Size*100
vuln$Recent_Drug_Use <- vuln$Recent_Drug_Use/vuln$Population_Size*100
vuln$Uninsured <- vuln$Uninsured/vuln$Population_Size*100
vuln$Elderly_Medicare <- vuln$Elderly_Medicare/vuln$Population_Size*100
vuln$Disabled_Medicare <- vuln$Disabled_Medicare/vuln$Population_Size*100
vuln$DeathRate <- vuln$All_Death/vuln$Population_Size*100

DF_Bar <- sqldf( 'select Poverty,Unemployed,Sev_Work_Disabled,Recent_Drug_Use,No_Exercise,Obesity,High_Blood_Pres,Smoker,Diabetes,Uninsured,Elderly_Medicare, Disabled_Medicare 
                 from vuln')
PLot_Bar <- replace(DF_Bar, TRUE, lapply(DF_Bar, na_mean_swap))
```

#Calculate mean of each column

```{r}
PLot_Bar <- colMeans(PLot_Bar)
```


#Implement melt
```{r}
library(reshape)
```

#this makes each row a unique id-variable combination

```{r}
PLot_Bar <- melt(PLot_Bar)
PLot_Bar$Variables <- rownames(PLot_Bar)
```

#used Cookbook for R, Colors(ggplot2) for assistance
#toned the colors down to be a bit darker and match the colors of our other graphs

```{r}
BarPlotFin<- ggplot(data=PLot_Bar) + geom_bar(aes(x = Variables,y=value,fill=Variables),stat="identity") + coord_flip() +scale_fill_hue(l=45) + ggtitle('Figure 3 - Population Health Statistics')
BarPlotFin
```

##### Plot Average Life Expectancy by State #####
#assistance from https://www.datanovia.com/en/blog/ggplot-themes-gallery/
```{r}
Life_Exp_States <- ggplot(data = mean_clean, aes(x=CHSI_State_Abbr, y = ALE, color = ALE, group=CHSI_State_Abbr)) + 
  geom_point() +
  scale_color_continuous(name = "Average Age") +
  theme_classic() +
  xlab(label = "States") +
  ylab(label = "Average Life Expectancy") + 
  ggtitle(label = "Figure 4 - State Average Life Expectancy") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
Life_Exp_States
```

######plot ALE Under 1st Quartile######
```{r}
Life_Exp_75 <- ggplot(data = mean_clean[mean_clean$ALE<75,], aes(x=CHSI_State_Abbr, y = ALE, color = ALE, group=CHSI_State_Abbr)) + 
  geom_point() +
  scale_color_continuous(name = "Average Age") +
  theme_classic() +
  xlab(label = "States") +
  ylab(label = "Average Life Expectancy") + 
  scale_y_reverse() +
  ggtitle(label = "State ALE Below Nation's 1st Quartile") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
Life_Exp_75
```

#Suicide

```{r}
mean_clean$totalSuicide <- mean_clean$C_Bl_Suicide+mean_clean$C_Hi_Suicide+mean_clean$C_Ot_Suicide+mean_clean$C_Wh_Suicide+mean_clean$D_Bl_Suicide+mean_clean$D_Wh_Suicide+mean_clean$D_Hi_Suicide+mean_clean$D_Ot_Suicide
mean_clean$percentSuicide <- (mean_clean$totalSuicide/mean_clean$Population_Size)*100
```

#Homicide 

```{r}
mean_clean$totalHomicide <- mean_clean$C_Bl_Homicide+mean_clean$C_Hi_Homicide+mean_clean$C_Wh_Homicide+mean_clean$D_Bl_Homicide+mean_clean$D_Wh_Homicide+mean_clean$D_Hi_Homicide
mean_clean$percentHomicide <- (mean_clean$totalHomicide/mean_clean$Population_Size)*100
mean_clean$percentAllDeath <- (mean_clean$All_Death/mean_clean$Population_Size)*100
deathDf <- sqldf('select percentSuicide, percentHomicide, percentAllDeath from mean_clean')
deathDfMeans <- colMeans(deathDf)
deathDfMeans <- melt(deathDfMeans)
deathDfMeans$variables <- rownames(deathDfMeans)
BarPlotDeath<- ggplot(data=deathDfMeans) + geom_bar(aes(x = variables,y=value,fill=variables),stat="identity") + coord_flip() +scale_fill_hue(l=45) + ggtitle('Figure 5 - Suicide/Homicide Statistics')
BarPlotDeath
```

##### Suicide by State####
#excluding outliers#
```{r}
mean_clean_noOutliers <- mean_clean[which(mean_clean$percentSuicide < "100"),]
Suicide_by_States <- ggplot(data = mean_clean_noOutliers, aes(x=CHSI_State_Abbr, y = percentSuicide, color = percentSuicide, group=CHSI_State_Abbr)) + 
  geom_point() +
  scale_color_continuous(name = "Percent Suicide") +
  theme_classic() +
  xlab(label = "States") +
  ylab(label = "% of Suicides") + 
  ggtitle(label = "Figure 5 - Suicides by State") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
Suicide_by_States
```

##### Homicide by State####

```{r}
Homicide_by_States <- ggplot(data = mean_clean, aes(x=CHSI_State_Abbr, y = percentHomicide, color = percentHomicide, group=CHSI_State_Abbr)) + 
  geom_point() +
  scale_color_continuous(name = "Percent Homicide") +
  theme_classic() +
  xlab(label = "States") +
  ylab(label = "% of Homicide") + 
  ggtitle(label = "Figure 6 - Homicides by State") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
Homicide_by_States
```


################ Plot of Smokers relating to ALE and Exercise ################ #####################################################################
# Shows a plot of no exercise to ALE. Less smoking in green, heavy smoking in blue. 
#determine the range of smokers 
```{r}
summary(combined$Smoker)
```
#plot assistance from https://www.datanovia.com/en/blog/ggplot-themes-gallery/

```{r}
gtt <- ggplot(data = combined, aes(x=No_Exercise, y = ALE,   color = Smoker)) + 
  theme_classic() +  
  geom_point() +  
  xlab(label = "Percent not Exercising") +
  #scale_x_reverse() + #x_axis reversed to show positive correlation
  ylab(label = "Average Life Expectancy") + 
  scale_colour_gradient(limits=c(3.6,46.2), low="green", high="red") + #Smoker Range
  ggtitle(label = "Negative Affects of Smoking and Not Working Out on ALE")
gtt
```
# Linear regression
A linear model was built using variables like Age, Demographics, Drug Usage, Use of Toxic Chem, No Exercise, Fruit intake, Blood Pressure, Diabetes and an R-squared value of 71.2% was obtained that explained the variability on Average life expectancy in a county.

```{r linear, include=TRUE}
ndf <-read.csv("C:/Users/Caitlin Casey/Desktop/SYRACUSE/USA_CHSI_DATASET/ndf.csv")
mean_clean$HIV <- ndf$D_Hi_HIV+ndf$D_Bl_HIV+ndf$D_Hi_HIV
mean_clean$E_Cancer <- ndf$E_Wh_Cancer + ndf$E_Bl_Cancer + ndf$E_Ot_Cancer + ndf$E_Hi_Cancer
mean_clean$E_HeartDis <- ndf$E_Wh_HeartDis + ndf$E_Bl_HeartDis + ndf$E_Ot_HeartDis + ndf$E_Hi_HeartDis
mean_clean$F_HeartDis <- ndf$F_Wh_HeartDis + ndf$F_Bl_HeartDis + ndf$F_Ot_HeartDis + ndf$F_Hi_HeartDis
mean_clean$F_Cancer <- ndf$F_Wh_Cancer + ndf$F_Bl_Cancer + ndf$F_Ot_Cancer + ndf$F_Hi_Cancer
ndf_lr <- mean_clean[,c('Poverty','Age_19_Under','Age_19_64','Age_65_84','Age_85_and_Over','White','Black','Native_American','Asian','Hispanic','Recent_Drug_Use','Toxic_Chem','No_Exercise','Few_Fruit_Veg','Obesity','High_Blood_Pres','Smoker','Diabetes','HIV','E_HeartDis','F_HeartDis','ALE')]
linear_ndf <- lm(ALE~.,ndf_lr)
summary(linear_ndf)$r.squared 
```
# svm model
Linear and Polynomial kernal gave an error of 0.03% for a cost of 1 and 50. So we decided to go with a cost of 1 with the linear model.

```{ r svm results, include=FALSE}
str(ndf)
```

#svm- linear kernel, cost = 1

```{r}
library(e1071)
testset1 <- ndf[1:1000,]
trainset1 <- ndf[1001:3142,]
svm1 <- svm(ALE ~., data = trainset1, kernel = "linear", type = "eps", cost=1)
pred=predict(svm1, testset1[,-38], type=c("eps"))
pred
library(caret)
conf <- data.frame(pred,testset1$ALE)
sqrt((mean(conf$pred-conf$testset1.ALE)^2))
plot(pred~testset1$ALE)
```

#svm-linear, cost = 20
```{r}
testset1 <- ndf[1:1000,]
trainset1 <- ndf[1001:3142,]
svm1 <- svm(ALE ~., data = trainset1, kernel = "linear", type = "eps", cost = 20)
pred=predict(svm1, testset1, type=c("eps"))
library(caret)
conf.linear <- data.frame(pred,testset1$ALE)
sqrt((mean(conf.linear$pred-conf.linear$testset1.ALE)^2))
```

#svm-polynomial, cost = 50-0.03

```{r}
testset1 <- ndf[1:1000,]
trainset1 <- ndf[1001:3142,]
svm1 <- svm(ALE ~., data = trainset1, kernel = "polynomial", type = "eps", cost = 50)
pred=predict(svm1, testset1[,-38], type=c("eps"))
library(caret)
conf.polynomial <- data.frame(pred,testset1$ALE)
sqrt((mean(conf.linear$pred-conf.linear$testset1.ALE)^2))
```

#svm-polynomial, cost = 50- 0.039

```{r}
testset1 <- ndf[1:1000,]
trainset1 <- ndf[1001:3142,]
svm1 <- svm(ALE ~., data = trainset1, kernel = "radial", type = "eps", cost = 50)
pred=predict(svm1, testset1[,-38], type=c("eps"))
library(caret)
conf.radial <- data.frame(pred,testset1$ALE)
sqrt((mean(pred-testset1$ALE)^2))
```

#Decision Tree

```{r Decision Tree, include=TRUE}
library(rpart)
library(rpart.plot)
set.seed(50)
dt <- rpart(ALE~.,trainset1,method  = "anova", control = rpart.control(cp = 0, maxdepth = 7,minsplit = 200))
rpart.plot(dt)
pred_dt <- predict(dt, testset1[,-38])
library(caret)
conf.dt <- data.frame(pred,testset1$ALE)
sqrt((mean(pred_dt-testset1$ALE)^2))
```

#Random Forest

```{r Random Forest, include=TRUE}
library(randomForest)
library(caret)
set.seed(50)
rfm_chsi <- randomForest(ALE~., data=trainset1, ntree=11, na.action=na.exclude)
print(rfm_chsi)
predRF <- predict(rfm_chsi, testset1[,-38])
conf.RF <- data.frame(pred,testset1$ALE)
sqrt((mean(predRF-testset1$ALE)^2))
plot(pred,testset1$ALE, col='red', main="Random Forest")
```

#Naive Bayes

